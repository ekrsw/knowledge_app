# 承認キュー「提出日時」修正タスクリスト

## 概要
承認キューで表示される「提出日時」が`created_at`（修正案作成日時）ではなく、実際の提出日時（`submitted_at`）を表示するように修正する。

## 現在の問題
- 承認キューの「提出日時」に`created_at`が使用されている
- 修正案が下書きとして何日も編集された後に提出されても、最初の作成日時が表示される
- 業務上、承認者は実際の提出日時を知る必要がある

## 実装タスク

### Phase 1: データベース設計
- [ ] **タスク1**: Revisionモデルに`submitted_at`フィールドを追加
  - nullable=True
  - DateTime(timezone=True)型
  - 初期値はNone

- [ ] **タスク2**: データベースマイグレーションを作成
  - 新しい`submitted_at`カラムを追加
  - 既存の`submitted`ステータスのレコードに初期値設定

- [ ] **タスク3**: マイグレーションを実行
  - ローカル開発環境で実行
  - 既存データの整合性確認

### Phase 2: ビジネスロジック更新
- [ ] **タスク4**: ProposalServiceの`submit_proposal()`メソッド修正
  - 状態遷移時に`submitted_at`を現在日時に設定
  - draft → submitted の遷移でタイムスタンプ記録

- [ ] **タスク5**: ApprovalServiceの`get_approval_queue()`メソッド修正
  - `created_at`の代わりに`submitted_at`を使用
  - 承認キューで正確な提出日時を返却

### Phase 3: スキーマ・リポジトリ更新
- [ ] **タスク6**: RevisionUpdateスキーマに`submitted_at`フィールド追加
  - オプショナルフィールドとして追加
  - 型定義の整合性確保

- [ ] **タスク7**: リポジトリクエリの確認と更新
  - revision_repository の既存クエリが`submitted_at`を適切に扱うか確認
  - 必要に応じて修正

### Phase 4: テスト・検証
- [ ] **タスク8**: 単体テスト実行
  - revision関連のテストが通ることを確認
  - 新しい`submitted_at`フィールドのテストケース追加

- [ ] **タスク9**: 統合テスト実行
  - 承認キューAPIのテスト実行
  - 提出日時が正しく表示されることを確認

- [ ] **タスク10**: フロントエンドでの動作確認
  - 承認キュー画面で提出日時が正しく表示されることを確認
  - 新規提出時の動作確認

### Phase 5: データ整合性確認
- [ ] **タスク11**: 既存データの検証
  - マイグレーション後のデータが正しいことを確認
  - submitted ステータスのレコードに適切な`submitted_at`が設定されていることを確認

## 実装順序
1. **Phase 1**: データベース設計とマイグレーション
2. **Phase 2**: ビジネスロジック更新
3. **Phase 3**: スキーマ・リポジトリ更新
4. **Phase 4**: テスト・検証
5. **Phase 5**: データ整合性確認

## 成功基準
- [ ] 承認キューで「提出日時」に実際の提出日時が表示される
- [ ] 下書きから提出への状態遷移時に`submitted_at`が正しく設定される
- [ ] 既存の全テストが通る
- [ ] 新規作成した修正案の提出フローが正常に動作する
- [ ] データベースの整合性が保たれている

## 注意事項
- 既存の`created_at`は削除せず、併存させる
- `submitted_at`がNullの場合のフォールバック処理を検討
- 承認済み・却下済みのレコードは`processed_at`との使い分けを明確にする